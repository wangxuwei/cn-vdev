const router = require('cmdrouter');
const fs = require('fs-extra-plus');
const path = require('path');
const spawn = require('p-spawn');


router.router({ clean }).route();


async function clean(pathDir) {
	const projectPath = pathDir;
	await spawn.spawn("rm", ["-rf", path.join(projectPath, "node_modules")]);
	await spawn.spawn("rm", ["-rf", path.join(projectPath, "package-lock.json")]);

	const files = await fs.readdir(path.join(projectPath, "services"));
	const prefix = path.join(projectPath, "services");
	for (const dir of files) {
		if (await fs.pathExists(path.join(prefix, dir, "node_modules"))) {
			await spawn.spawn("rm", ["-rf", path.join(prefix, dir, "node_modules")]);
		}
		if (await fs.pathExists(path.join(prefix, dir, "package-lock.json"))) {
			await spawn.spawn("rm", ["-rf", path.join(prefix, dir, "package-lock.json")]);
		}
	}
}